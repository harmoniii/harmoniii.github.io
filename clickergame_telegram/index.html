<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <title>Grid Clicker â€” Telegram Game</title>
  
  <!-- Telegram Web App Script -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- Telegram Web App Meta Tags -->
  <meta name="telegram-app" content="true">
  
  <!-- Ğ£Ğ»ÑƒÑ‡ÑˆĞµĞ½Ğ½Ñ‹Ğµ CSS ÑÑ‚Ğ¸Ğ»Ğ¸ Ğ´Ğ»Ñ Telegram -->
  <link rel="stylesheet" href="telegram-styles.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="telegram-webapp">
  <!-- Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ´Ğ»Ñ Telegram -->
  <div id="telegram-loading" class="telegram-loading">
    <div class="loading-spinner"></div>
    <div class="loading-text">ğŸ® Loading Grid Clicker...</div>
  </div>

  <!-- Ğ’ĞµÑ€Ñ…Ğ½ÑÑ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ (ÑĞºÑ€Ñ‹Ñ‚Ğ° Ğ² Telegram) -->
  <div id="ui-top" class="telegram-hidden-controls">
    <button id="toggle-buildings">ğŸ—ï¸ Buildings</button>
    <button id="toggle-skills">ğŸ¯ Skills</button>
    <button id="toggle-raids" style="display: none;">âš”ï¸ Raids</button>
    <button id="toggle-market">ğŸ›’ Market</button>
    <button id="info-button">ğŸ“š Info</button>
  </div>

  <!-- ĞÑĞ½Ğ¾Ğ²Ğ½Ğ°Ñ Ğ¸Ğ³Ñ€Ğ¾Ğ²Ğ°Ñ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑŒ -->
  <div id="game-area" class="telegram-game-area">
    <div class="grid-game-container">
      
      <!-- Ğ›ĞµĞ²Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ñ Ñ€ĞµÑÑƒÑ€ÑĞ°Ğ¼Ğ¸ -->
      <div class="left-panel telegram-panel">
        <div class="resources-section">
          <h4>ğŸ“¦ Basic</h4>
          <div id="basic-resources" class="resources-group"></div>
        </div>
        
        <div class="resources-section">
          <h4>âš—ï¸ Advanced</h4>
          <div id="advanced-resources" class="resources-group"></div>
        </div>
        
        <div class="resources-section">
          <h4>âœ¨ Special</h4>
          <div id="special-resources" class="resources-group"></div>
        </div>
      </div>

      <!-- Ğ˜Ğ³Ñ€Ğ¾Ğ²Ğ°Ñ ÑĞµÑ‚ĞºĞ° Ğ¿Ğ¾ Ñ†ĞµĞ½Ñ‚Ñ€Ñƒ -->
      <div class="game-grid-center">
        <canvas id="gameCanvas" width="350" height="350"></canvas>
      </div>

      <!-- ĞŸÑ€Ğ°Ğ²Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸ĞµĞ¹ -->
      <div class="right-panel telegram-panel">
        
        <!-- ĞšĞ¾Ğ¼Ğ±Ğ¾ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ -->
        <div class="combo-indicator" id="combo-indicator">
          <div class="combo-title">COMBO</div>
          <div class="combo-value" id="combo-value">0</div>
          <div class="combo-bonus" id="combo-bonus">Hit the target!</div>
        </div>

        <!-- Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ñ -->
        <div class="energy-display-container" id="energy-display">
          <div class="energy-bar-container">
            <div class="energy-bar-background">
              <div class="energy-bar energy-normal"></div>
            </div>
          </div>
          <div class="energy-text">âš¡ 100/100</div>
          <div class="energy-status ready">Ready!</div>
          <div class="energy-warning hidden">âš¡ Low!</div>
        </div>
        
      </div>
    </div>

    <!-- Ğ‘Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ Ğ´Ğ»Ñ Telegram -->
    <div class="telegram-quick-actions">
      <button id="tg-buildings-btn" class="tg-action-btn">ğŸ—ï¸</button>
      <button id="tg-skills-btn" class="tg-action-btn">ğŸ¯</button>
      <button id="tg-raids-btn" class="tg-action-btn" style="display: none;">âš”ï¸</button>
      <button id="tg-market-btn" class="tg-action-btn">ğŸ›’</button>
    </div>
  </div>

  <!-- ĞŸĞ°Ğ½ĞµĞ»ÑŒ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ° -->
  <div id="panel-container" class="list-panel hidden telegram-panel"></div>

  <!-- ĞĞ¸Ğ¶Ğ½Ğ¸Ğµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ (ÑĞºÑ€Ñ‹Ñ‚Ñ‹ Ğ² Telegram) -->
  <div id="controls-bottom" class="telegram-hidden-controls">
    <button id="load-button">ğŸ“ Load</button>
    <button id="save-button">ğŸ’¾ Save</button>
    <button id="reset-button">ğŸ”„ Reset</button>
    <button disabled>Telegram v1.0</button>
  </div>

  <!-- Ğ¡Ğ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ -->
  <div id="notifications"></div>
  <div id="mystery-modal" class="modal hidden"></div>
  <div id="info-modal" class="modal hidden"></div>
  <div id="effect-indicators" class="effect-indicators"></div>

  <!-- Telegram Web App Scripts -->
  <script type="module">
    import { TelegramWebAppAdapter } from './telegram-webapp-adapter.js';
    import { initializeTelegramGame } from './telegram-game-integration.js';

    // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Telegram Web App
    const telegramAdapter = new TelegramWebAppAdapter();
    
    // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ°Ğ´Ğ°Ğ¿Ñ‚ĞµÑ€ Ğ² Ğ³Ğ»Ğ¾Ğ±Ğ°Ğ»ÑŒĞ½ÑƒÑ Ğ¾Ğ±Ğ»Ğ°ÑÑ‚ÑŒ
    window.telegramAdapter = telegramAdapter;
    
    // Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¸Ğ³Ñ€Ñƒ Ğ¿Ğ¾ÑĞ»Ğµ Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ Telegram
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        // Ğ¡ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ ÑĞºÑ€Ğ°Ğ½
        const loadingElement = document.getElementById('telegram-loading');
        if (loadingElement) {
          loadingElement.style.display = 'none';
        }

        // ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ Telegram
        setupTelegramUI();
        
        // Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½ÑƒÑ Ğ¸Ğ³Ñ€Ñƒ
        await initializeTelegramGame();
        
        // Ğ˜Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€ÑƒĞµĞ¼ Ñ Telegram Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¸Ğ³Ñ€Ñ‹
        if (window.gameCore) {
          telegramAdapter.setupGameIntegration(window.gameCore);
          telegramAdapter.bindGameEvents();
        }
        
        console.log('âœ… Telegram Web App fully loaded');
        
      } catch (error) {
        console.error('âŒ Failed to initialize Telegram Web App:', error);
        
        // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
        const errorDiv = document.createElement('div');
        errorDiv.innerHTML = `
          <div style="text-align: center; padding: 2rem; color: red;">
            <h3>âŒ Loading Error</h3>
            <p>Failed to load the game. Please try again.</p>
            <button onclick="location.reload()">ğŸ”„ Reload</button>
          </div>
        `;
        document.body.appendChild(errorDiv);
      }
    });

    function setupTelegramUI() {
      // ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ğµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ Ğ´Ğ»Ñ Telegram
      const quickActions = {
        'tg-buildings-btn': 'buildings',
        'tg-skills-btn': 'skills', 
        'tg-raids-btn': 'raids',
        'tg-market-btn': 'market'
      };

      Object.entries(quickActions).forEach(([buttonId, panelType]) => {
        const button = document.getElementById(buttonId);
        if (button) {
          button.addEventListener('click', () => {
            // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ haptic feedback
            telegramAdapter.hapticFeedback('selection');
            
            // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒÑÑ‰ÑƒÑ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
            if (window.gameCore?.managers?.ui) {
              window.gameCore.managers.ui.showPanel(panelType);
            }
          });
        }
      });

      // Ğ¡ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ½ĞµĞ½ÑƒĞ¶Ğ½Ñ‹Ğµ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ² Telegram
      const hiddenElements = document.querySelectorAll('.telegram-hidden-controls');
      hiddenElements.forEach(el => {
        el.style.display = 'none';
      });

      // ĞĞ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€ÑƒĞµĞ¼ Ñ€Ğ°Ğ·Ğ¼ĞµÑ€Ñ‹ Ğ´Ğ»Ñ Telegram
      const canvas = document.getElementById('gameCanvas');
      if (canvas && telegramAdapter.tg.viewportHeight < 600) {
        canvas.width = 280;
        canvas.height = 280;
      }

      console.log('âœ… Telegram UI setup completed');
    }

    // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ´Ğ»Ñ Telegram
    window.addEventListener('error', (e) => {
      console.error('Telegram WebApp error:', e);
      
      if (telegramAdapter.tg.HapticFeedback) {
        telegramAdapter.hapticFeedback('error');
      }
    });
  </script>

  <!-- ĞÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğµ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹ Ğ¸Ğ³Ñ€Ñ‹ -->
  <script type="module" src="game.js"></script>
</body>
</html>