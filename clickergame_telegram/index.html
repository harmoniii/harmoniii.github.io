<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
  <title>Restoration: Chronicles of Survival</title>
  
  <!-- Telegram Web App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  
  <!-- Game Styles - Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… -->
  <link rel="stylesheet" href="styles.css">
  
  <!-- Preload ĞºÑ€Ğ¸Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² -->
  <link rel="preload" href="game.js" as="script">
  <link rel="preload" href="telegram-integration.js" as="script">
</head>
<body class="telegram-webapp">
  <!-- Telegram Web App Loading Screen -->
  <div id="telegram-loading" class="telegram-loading">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <h2>ğŸ® Grid Clicker</h2>
      <p>Loading Telegram Web App...</p>
      <div class="loading-progress">
        <div class="progress-bar" id="loading-progress"></div>
      </div>
    </div>
  </div>

  <!-- Error Screen -->
  <div id="telegram-error" class="telegram-error hidden">
    <div class="error-content">
      <h2>âŒ Error</h2>
      <p id="error-message">Failed to load Telegram Web App</p>
      <button id="retry-button" class="retry-btn">ğŸ”„ Retry</button>
    </div>
  </div>

  <!-- ĞšĞ¾Ğ¼Ğ¿Ğ°ĞºÑ‚Ğ½Ğ°Ñ Ğ½Ğ°Ğ²Ğ¸Ğ³Ğ°Ñ†Ğ¸Ñ Ğ´Ğ»Ñ Telegram -->
  <div id="ui-top" class="telegram-nav">
    <button id="toggle-buildings" class="nav-btn">ğŸ—ï¸</button>
    <button id="toggle-skills" class="nav-btn">ğŸ¯</button>
    <button id="toggle-raids" class="nav-btn" style="display: none;">âš”ï¸</button>
    <button id="toggle-market" class="nav-btn">ğŸ›’</button>
    <button id="info-button" class="nav-btn">ğŸ“š</button>
  </div>

  <!-- Ğ˜Ğ³Ñ€Ğ¾Ğ²Ğ°Ñ Ğ·Ğ¾Ğ½Ğ° Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ Ğ´Ğ»Ñ Telegram -->
  <div id="game-area" class="telegram-game-area">
    <div class="grid-game-container telegram-layout">
      
      <!-- Ğ›ĞµĞ²Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ñ€ĞµÑÑƒÑ€ÑĞ¾Ğ² - ĞºĞ¾Ğ¼Ğ¿Ğ°ĞºÑ‚Ğ½Ğ°Ñ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ±Ğ¸Ğ»ÑŒĞ½Ñ‹Ñ… -->
      <div class="left-panel telegram-resources">
        <div class="resources-section compact">
          <h4>ğŸ“¦ Resources</h4>
          <div id="basic-resources" class="resources-group"></div>
        </div>
        
        <div class="resources-section compact">
          <h4>âš—ï¸ Advanced</h4>
          <div id="advanced-resources" class="resources-group"></div>
        </div>
        
        <div class="resources-section compact">
          <h4>âœ¨ Special</h4>
          <div id="special-resources" class="resources-group"></div>
        </div>
      </div>

      <!-- Ğ˜Ğ³Ñ€Ğ¾Ğ²Ğ°Ñ ÑĞµÑ‚ĞºĞ° - Ğ¾Ğ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ° Ğ´Ğ»Ñ ĞºĞ°ÑĞ°Ğ½Ğ¸Ğ¹ -->
      <div class="game-grid-center telegram-grid">
        <canvas id="gameCanvas" width="300" height="300" class="telegram-canvas"></canvas>
      </div>

      <!-- ĞŸÑ€Ğ°Ğ²Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ - ĞºĞ¾Ğ¼Ğ¿Ğ°ĞºÑ‚Ğ½Ğ°Ñ -->
      <div class="right-panel telegram-info">
        
        <!-- ĞšĞ¾Ğ¼Ğ±Ğ¾ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ -->
        <div class="combo-indicator telegram-combo" id="combo-indicator">
          <div class="combo-title">COMBO</div>
          <div class="combo-value" id="combo-value">0</div>
          <div class="combo-bonus" id="combo-bonus">Hit red!</div>
        </div>

        <!-- Ğ­Ğ½ĞµÑ€Ğ³Ğ¸Ñ -->
        <div class="energy-display-container telegram-energy" id="energy-display">
          <div class="energy-bar-container">
            <div class="energy-bar-background">
              <div class="energy-bar energy-normal"></div>
            </div>
          </div>
          <div class="energy-text">âš¡ 100/100</div>
          <div class="energy-status ready">Ready!</div>
          <div class="energy-warning hidden">âš¡ Low!</div>
        </div>
        
      </div>
    </div>
  </div>

  <!-- ĞŸĞ°Ğ½ĞµĞ»ÑŒ ĞºĞ¾Ğ½Ñ‚ĞµĞ½Ñ‚Ğ° -->
  <div id="panel-container" class="list-panel hidden telegram-panel"></div>

  <!-- Telegram Web App Controls -->
  <div id="telegram-controls" class="telegram-controls">
    <button id="cloud-save-btn" class="telegram-btn">â˜ï¸ Cloud Save</button>
    <button id="leaderboard-btn" class="telegram-btn">ğŸ† Leaders</button>
    <button id="share-btn" class="telegram-btn">ğŸ“¤ Share</button>
  </div>

  <!-- ĞšĞ¾Ğ¼Ğ¿Ğ°ĞºÑ‚Ğ½Ñ‹Ğµ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ¾Ğ»Ñ‹ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ -->
  <div id="controls-bottom" class="telegram-bottom-controls">
    <button id="load-button" class="control-btn">ğŸ“</button>
    <button id="save-button" class="control-btn">ğŸ’¾</button>
    <button id="reset-button" class="control-btn">ğŸ”„</button>
    <button id="telegram-menu-btn" class="control-btn">âš™ï¸</button>
  </div>

  <!-- Ğ£Ğ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ñ - Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ»Ñ Telegram -->
  <div id="notifications" class="telegram-notifications"></div>
  
  <!-- ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¾ĞºĞ½Ğ° -->
  <div id="mystery-modal" class="modal hidden"></div>
  <div id="info-modal" class="modal hidden"></div>
  
  <!-- Ğ˜Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹ ÑÑ„Ñ„ĞµĞºÑ‚Ğ¾Ğ² -->
  <div id="effect-indicators" class="effect-indicators telegram-effects"></div>

  <!-- Telegram Menu Modal -->
  <div id="telegram-menu" class="telegram-menu hidden">
    <div class="menu-content">
      <h3>âš™ï¸ Game Menu</h3>
      <button id="telegram-stats-btn" class="menu-btn">ğŸ“Š Statistics</button>
      <button id="telegram-achievements-btn" class="menu-btn">ğŸ† Achievements</button>
      <button id="telegram-help-btn" class="menu-btn">â“ Help</button>
      <button id="telegram-about-btn" class="menu-btn">â„¹ï¸ About</button>
      <button id="close-menu-btn" class="menu-btn close-btn">âœ–ï¸ Close</button>
    </div>
  </div>

  <!-- Cloud Save Modal -->
  <div id="cloud-save-modal" class="modal hidden">
    <div class="modal-content">
      <h3>â˜ï¸ Cloud Save</h3>
      <div id="cloud-save-content">
        <p>Synchronizing with Telegram Cloud...</p>
        <div class="loading-spinner small"></div>
      </div>
      <div class="modal-footer">
        <button id="close-cloud-modal" class="modal-close">Close</button>
      </div>
    </div>
  </div>

  <!-- Leaderboard Modal -->
  <div id="leaderboard-modal" class="modal hidden">
    <div class="modal-content">
      <h3>ğŸ† Leaderboard</h3>
      <div id="leaderboard-content">
        <p>Loading leaderboard...</p>
        <div class="loading-spinner small"></div>
      </div>
      <div class="modal-footer">
        <button id="close-leaderboard-modal" class="modal-close">Close</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script type="module" src="telegram-integration.js"></script>
  <script type="module" src="game.js"></script>

  <!-- Telegram Web App Error Handler -->
  <script>
    // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº Ğ´Ğ»Ñ Telegram Web App
    window.addEventListener('error', (e) => {
      console.error('Telegram Web App Error:', e);
      
      const loadingScreen = document.getElementById('telegram-loading');
      const errorScreen = document.getElementById('telegram-error');
      const errorMessage = document.getElementById('error-message');
      
      if (loadingScreen) loadingScreen.classList.add('hidden');
      if (errorScreen) errorScreen.classList.remove('hidden');
      if (errorMessage) errorMessage.textContent = e.message || 'Unknown error occurred';
      
      // ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¾ÑˆĞ¸Ğ±ĞºÑƒ Ğ² Telegram
      if (window.Telegram?.WebApp) {
        window.Telegram.WebApp.sendData(JSON.stringify({
          type: 'error_report',
          error: {
            message: e.message,
            filename: e.filename,
            lineno: e.lineno,
            timestamp: Date.now()
          }
        }));
      }
    });

    // Retry ĞºĞ½Ğ¾Ğ¿ĞºĞ°
    document.addEventListener('DOMContentLoaded', () => {
      const retryBtn = document.getElementById('retry-button');
      if (retryBtn) {
        retryBtn.addEventListener('click', () => {
          location.reload();
        });
      }
    });
  </script>
</body>
</html>